---
title: Публикация приложений и взаимодействие с клиентом
description: Публикация приложений и взаимодействие с клиентом
author: dansimp
ms.assetid: 36a4bf6f-a917-41a6-9856-6248686df352
ms.reviewer: ''
manager: dansimp
ms.author: dansimp
ms.pagetype: mdop, appcompat, virtualization
ms.mktglfcycl: deploy
ms.sitesec: library
ms.prod: w10
ms.date: 08/30/2016
ms.openlocfilehash: b94ef87043d428ac92fe1656b3afeb8a8b743808
ms.sourcegitcommit: 3e0500abde44d6a09c7ac8e3caf5e25929b490a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2021
ms.locfileid: "11910824"
---
# <a name="application-publishing-and-client-interaction"></a>Публикация приложений и взаимодействие с клиентом


В этой статье приводится техническая информация об общих клиентских операциях App-V и их интеграции с локальной операционной системой.

-   [Файлы пакета App-V, созданные секвенсором](#bkmk-appv-pkg-files-list)

-   [Что в файле appv?](#bkmk-appv-file-contents)

-   [Расположение хранилища данных клиента App-V](#bkmk-files-data-storage)

-   [Реестр пакетов](#bkmk-pkg-registry)

-   [Поведение магазина пакетов App-V](#bkmk-pkg-store-behavior)

-   [Реестр и данные в роуминге](#bkmk-roaming-reg-data)

-   [Управление жизненным циклом клиентских приложений App-V](#bkmk-clt-app-lifecycle)

-   [Интеграция пакетов App-V](#bkmk-integr-appv-pkgs)

-   [Динамическая обработка конфигурации](#bkmk-dynamic-config)

-   [Боковая сборка](#bkmk-sidebyside-assemblies)

-   [Ведение журнала клиента](#bkmk-client-logging)

Дополнительные справочные сведения см. в странице Загрузка ресурсов документации [Microsoft Application Virtualization (App-V).](https://www.microsoft.com/download/details.aspx?id=27760)

## <a name="app-v-package-files-created-by-the-sequencer"></a><a href="" id="bkmk-appv-pkg-files-list"></a>Файлы пакета App-V, созданные секвенсором


Секвенсор создает пакеты App-V и создает виртуализированное приложение. Процесс секвенации создает следующие файлы:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Файл</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>.appv</p></td>
<td align="left"><ul>
<li><p>Основной файл пакета, содержащий захваченные активы и сведения о состоянии из процесса секвенации.</p></li>
<li><p>Архитектура файла пакета, сведений о публикации и реестра в маркеризированной форме, которые можно повторно использовать для компьютера и определенного пользователя при доставке.</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>.MSI</p></td>
<td align="left"><p>Исполняемая оболочка развертывания, которую можно использовать для развертывания файлов appv вручную или с помощью платформы развертывания сторонних разработчиков.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>_DeploymentConfig.XML</p></td>
<td align="left"><p>Файл, используемый для настройки параметров публикации по умолчанию для всех приложений в пакете, развернутом глобально для всех пользователей на компьютере, на компьютере с клиентом App-V.</p></td>
</tr>
<tr class="even">
<td align="left"><p>_UserConfig.XML</p></td>
<td align="left"><p>Файл, используемый для настройки параметров публикации для всех приложений в пакете, развернутом для определенного пользователя на компьютере, на который работает клиент App-V.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Report.xml</p></td>
<td align="left"><p>Сводка сообщений в результате процесса секвенации, включая пропущенные драйверы, файлы и расположения реестра.</p></td>
</tr>
<tr class="even">
<td align="left"><p>.CAB</p></td>
<td align="left"><p><em>Необязательный: файл акселератора пакета, используемый для автоматического восстановления ранее </em> последовательного виртуального пакета приложений.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>.appvt</p></td>
<td align="left"><p><em>Необязательный: файл шаблона секвенсора, используемый для сохранения часто </em> используемых параметров секвенсора.</p></td>
</tr>
</tbody>
</table>

 

Сведения о секвенации см. в руководстве по секвенизации [виртуализации приложений.](https://go.microsoft.com/fwlink/?LinkID=269810)

## <a name="whats-in-the-appv-file"></a><a href="" id="bkmk-appv-file-contents"></a>Что в файле appv?


Файл appv — это контейнер, который хранит XML и неХЛ-файлы вместе в одной сущности. Этот файл построен из формата AppX, который основан на стандарте Open Packaging Conventions (OPC).

Чтобы просмотреть содержимое файла appv, сделайте копию пакета и переименуите скопированные файлы в расширение ZIP.

Файл appv содержит следующие папки и файлы, которые используются при создании и публикации виртуального приложения:

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Имя</th>
<th align="left">Тип</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Корень</p></td>
<td align="left"><p>Папка файла</p></td>
<td align="left"><p>Каталог, содержащий файловую систему для виртуализированного приложения, захваченного во время секвенизации.</p></td>
</tr>
<tr class="even">
<td align="left"><p>[Content_Types].xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Список основных типов контента в файле appv (например, DLL, EXE, BIN).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AppxBlockMap.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Макет файла appv, в котором используются элементы File, Block и BlockMap, которые позволяют расположение и проверку файлов в пакете App-V.</p></td>
</tr>
<tr class="even">
<td align="left"><p>AppxManifest.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Метаданные для пакета, который содержит необходимые сведения для добавления, публикации и запуска пакета. Включает точки расширения (ассоциации типов файлов и ярлыки) и имена и GUID, связанные с пакетом.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>FilesystemMetadata.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Список файлов, захваченных во время секвениза, включая атрибуты (например, каталоги, файлы, непрозрачивые каталоги, пустые каталоги и длинные и короткие имена).</p></td>
</tr>
<tr class="even">
<td align="left"><p>PackageHistory.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Сведения о компьютере секвенации (версия операционной системы, версия Internet Explorer, версия .Net Framework) и процессе (обновление, версия пакета).</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Registry.dat</p></td>
<td align="left"><p>DAT File</p></td>
<td align="left"><p>Ключи и значения реестра, захваченные в процессе секвенации пакета.</p></td>
</tr>
<tr class="even">
<td align="left"><p>StreamMap.xml</p></td>
<td align="left"><p>XML-файл</p></td>
<td align="left"><p>Список файлов для основного блока и блока функций публикации. Блок функций публикации содержит файлы ICO и необходимые части файлов (EXE и DLL) для публикации пакета. При этом основной блок функций включает файлы, оптимизированные для потоковой передачи во время процесса секвенации.</p></td>
</tr>
</tbody>
</table>

 

## <a name="app-v-client-data-storage-locations"></a><a href="" id="bkmk-files-data-storage"></a>Расположение хранилища данных клиента App-V


Клиент App-V выполняет задачи, чтобы виртуальные приложения работали правильно и работали как локально установленные приложения. Процесс открытия и запуска виртуальных приложений требует сопоставления из виртуальной файловой системы и реестра, чтобы убедиться, что приложение имеет необходимые компоненты традиционного приложения, ожидаемого пользователями. В этом разделе описываются активы, необходимые для запуска виртуальных приложений, и перечисляется расположение, в котором App-V хранит активы.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Имя</th>
<th align="left">Расположение</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Хранилище пакетов</p></td>
<td align="left"><p>%ProgramData%\App-V</p></td>
<td align="left"><p>Расположение по умолчанию для чтения только файлов пакетов</p></td>
</tr>
<tr class="even">
<td align="left"><p>Каталог машин</p></td>
<td align="left"><p>%ProgramData%\Microsoft\AppV\Client\Catalog</p></td>
<td align="left"><p>Содержит документы конфигурации на одну машину</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Каталог пользователей</p></td>
<td align="left"><p>%AppData%\Microsoft\AppV\Client\Catalog</p></td>
<td align="left"><p>Содержит документы конфигурации для каждого пользователя</p></td>
</tr>
<tr class="even">
<td align="left"><p>Резервное копирование ярлыков</p></td>
<td align="left"><p>%AppData%\Microsoft\AppV\Client\Integration\ShortCutBackups</p></td>
<td align="left"><p>Сохраняет предыдущие точки интеграции, которые позволяют восстанавливать неопубликованный пакет</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Копирование в роуминге Write (COW)</p></td>
<td align="left"><p>%AppData%\Microsoft\AppV\Client\VFS</p></td>
<td align="left"><p>Расположение для записи роуминга для изменения пакета</p></td>
</tr>
<tr class="even">
<td align="left"><p>Скопируйте на записи (COW) Local</p></td>
<td align="left"><p>%LocalAppdata%\Microsoft\AppV\Client\VFS</p></td>
<td align="left"><p>Расположение без роуминга для изменения пакета</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Реестр машин</p></td>
<td align="left"><p>HKLM\Software\Microsoft\AppV</p></td>
<td align="left"><p>Содержит сведения о состоянии пакетов, включая VReg для машинных или глобально опубликованных пакетов (машинный улей)</p></td>
</tr>
<tr class="even">
<td align="left"><p>Реестр пользователей</p></td>
<td align="left"><p>HKCU\Software\Microsoft\AppV</p></td>
<td align="left"><p>Содержит сведения о состоянии пакета пользователей, включая VReg</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Классы реестра пользователей</p></td>
<td align="left"><p>HKCU\Software\Classes\AppV</p></td>
<td align="left"><p>Содержит дополнительные сведения о состоянии пакета пользователей</p></td>
</tr>
</tbody>
</table>

 

Дополнительные сведения для таблицы приведены в разделе ниже и во всем документе.

### <a name="package-store"></a>Хранилище пакетов

Клиент App-V управляет активами приложений, установленными в хранилище пакетов. Это расположение хранилища по умолчанию, но его можно настроить во время или после установки с помощью команды PowerShell, которая изменяет локальный реестр (значение под `%ProgramData%\App-V` `Set-AppVClientConfiguration` `PackageInstallationRoot` `HKLM\Software\Microsoft\AppV\Client\Streaming` ключом). Хранилище пакетов должно располагаться на локальном пути в клиентской операционной системе. Отдельные пакеты хранятся в хранилище пакетов в поднаправлениях с именем GUID пакета и GUID версии.

Пример пути к определенному приложению:

``` syntax
C:\ProgramData\App-V\PackGUID\VersionGUID
```

Чтобы изменить расположение магазина пакетов по умолчанию во время настройки, см. в приложении [How to Deploy the App-V Client.](how-to-deploy-the-app-v-client-51gb18030.md)

### <a name="shared-content-store"></a>Общий хранилище контента

Если клиент App-V настроен в режиме общего хранения контента, данные не будут записаны на диск при сбое потока, что означает, что пакеты требуют минимального локального пространства диска (данные публикации). Использование меньшего дискового пространства является весьма желательным в средах VDI, где локальное хранилище может быть ограничено, и предпочтительнее стриминг приложений из расположения высокоэффективной сети (например, SAN). Дополнительные сведения о режиме общего хранения контента см. в <https://go.microsoft.com/fwlink/p/?LinkId=392750> .

**Примечание.**  
Магазин машин и пакетов должен располагаться на локальном диске, даже если вы используете конфигурации общего хранения контента для клиента App-V.

 

### <a name="package-catalogs"></a>Каталоги пакетов

Клиент App-V управляет следующими двумя расположениями на основе файлов:

-   **Каталоги (пользователь и машина).**

-   **Расположение реестра** зависит от того, как пакет ориентирован на публикацию. Существует каталог (хранилище данных) для компьютера и каталог для каждого отдельного пользователя. Каталог машин хранит глобальную информацию, применимую к всем пользователям или любому пользователю, а каталог пользователей хранит сведения, применимые к конкретному пользователю. Каталог — это коллекция динамических конфигураций и файлов манифеста; существуют дискретные данные как для файла, так и для реестра для одной версии пакета. 

### <a name="machine-catalog"></a>Каталог машин

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p>Описание</p></td>
<td align="left"><p>Сохраняет пакетные документы, доступные пользователям на компьютере при добавлении и публикации пакетов. Однако, если пакет является "глобальным" во время публикации, интеграции доступны для всех пользователей.</p>
<p>Если пакет не является глобальным, интеграции публикуются только для определенных пользователей, но по-прежнему существуют глобальные ресурсы, которые изменены и видны любому пользователю на клиентном компьютере (например, каталог пакетов находится в расположении общего диска).</p>
<p>Если пакет доступен пользователю на компьютере (глобальной или не глобальной), манифест хранится в каталоге машин. При глобальной публикации пакета в каталоге машин хранится файл Динамическая конфигурация; Поэтому определение глобальности пакета определяется в зависимости от того, есть ли файл политики (файл UserDeploymentConfiguration) в каталоге машин.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Расположение хранилища по умолчанию</p></td>
<td align="left"><p><code>%programdata%\Microsoft\AppV\Client\Catalog&lt;/code&gt;</p>
<p>Это расположение не то же самое, что расположение магазина пакетов. Хранилище пакетов — это золотая или нетронутая копия файлов пакета.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Файлы в каталоге машин</p></td>
<td align="left"><ul>
<li><p>Manifest.xml</p></li>
<li><p>DeploymentConfiguration.xml</p></li>
<li><p>UserManifest.xml (глобальный опубликованный пакет)</p></li>
<li><p>UserDeploymentConfiguration.xml (глобальный опубликованный пакет)</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>Дополнительное расположение каталога машин, используемого, когда пакет входит в группу подключений.</p></td>
<td align="left"><p>Следующее расположение в дополнение к определенному расположению пакета, упомянутому выше:</p>
<p><code>%programdata%\Microsoft\AppV\Client\Catalog\PackageGroups\ConGroupGUID\ConGroupVerGUID</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Дополнительные файлы в каталоге машин, когда пакет входит в группу подключений</p></td>
<td align="left"><ul>
<li><p>PackageGroupDescriptor.xml</p></li>
<li><p>UserPackageGroupDescriptor.xml (глобально опубликованная группа подключения)</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

### <a name="user-catalog"></a>Каталог пользователей

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p>Описание</p></td>
<td align="left"><p>Создан в процессе публикации. Содержит сведения, используемые для публикации пакета, а также используемые при запуске, чтобы убедиться, что пакет был задан конкретному пользователю. Создан в роуминговом расположении и включает сведения о публикации для пользователей.</p>
<p>При публикации пакета для пользователя файл политики хранится в каталоге пользователей. В то же время копия манифеста также хранится в каталоге пользователей. При удалении права на пакет для пользователя соответствующие файлы пакетов удаляются из каталога пользователей. Если просмотреть каталог пользователей, администратор может просмотреть наличие файла динамической конфигурации, что указывает на то, что пакет имеет право для этого пользователя.</p>
<p>Для пользователей, перемещающихся по роумингу, каталог пользователей должен быть в роуминге или в общем расположении, чтобы сохранить устаревшее поведение App-V для ориентации пользователей по умолчанию. Права и политика привязаны к пользователю, а не компьютеру, поэтому они должны перемещаться с пользователем после их получения.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Расположение хранилища по умолчанию</p></td>
<td align="left"><p><code>appdata\roaming\Microsoft\AppV\Client\Catalog\Packages\PkgGUID\VerGUID</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Файлы в каталоге пользователей</p></td>
<td align="left"><ul>
<li><p>UserManifest.xml</p></li>
<li><p>DynamicConfiguration.xml или UserDeploymentConfiguration.xml</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p>Дополнительное расположение каталога пользователей, используемого, когда пакет входит в группу подключений.</p></td>
<td align="left"><p>Следующее расположение в дополнение к определенному расположению пакета, упомянутому выше:</p>
<p><code>appdata\roaming\Microsoft\AppV\Client\Catalog\PackageGroups\PkgGroupGUID\PkgGroupVerGUID</code></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Дополнительный файл в каталоге машины, когда пакет входит в группу подключений</p></td>
<td align="left"><p><code>UserPackageGroupDescriptor.xml</code></p></td>
</tr>
</tbody>
</table>

 

### <a name="shortcut-backups"></a>Резервное копирование ярлыков

В процессе публикации клиент App-V резервное копирование любых ярлыков и точки интеграции в это резервное копирование позволяет восстановить эти точки интеграции к предыдущим версиям при неопубликовке `%AppData%\Microsoft\AppV\Client\Integration\ShortCutBackups.` пакета.

### <a name="copy-on-write-files"></a>Копирование в файлах Write

Хранилище пакетов содержит чистую копию файлов пакетов, которые были потоковой передачи с сервера публикации. При нормальной работе приложения App-V пользователю или службе могут потребоваться изменения в файлах. Эти изменения не внесения в хранилище пакетов для сохранения возможности восстановления приложения, которое удаляет эти изменения. Эти расположения, называемые Copy on Write (COW), поддерживают как роуминг, так и не-роуминг. Расположение, в котором хранятся изменения, зависит от того, где приложение было запрограммировано для записи изменений в родной опыт.

### <a name="cow-roaming"></a>Роуминг COW

Расположение роуминга COW, описанное выше, сохраняет изменения в файлах и каталогах, которые ориентированы на типичное расположение %AppData% или \\Users\\{username}\\AppData\\Roaming. Затем эти каталоги и файлы перемещаются в зависимости от параметров операционной системы.

### <a name="cow-local"></a>Cow local

Расположение COW Local аналогично расположению в роуминге, но каталоги и файлы не перемещаются на другие компьютеры, даже если поддержка роуминга настроена. Расположение COW Local, описанное выше, сохраняет изменения, применимые к типичным окнам, а не к расположению %AppData%. Перечисленные каталоги различаются, но для любых типовых Windows (например, common AppData и Common AppDataS) будет два расположения. S **означает** ограниченное расположение, когда виртуальная служба запрашивает изменение как другой повышенный пользователь от входа в систему пользователей. В расположении,**не относя** к S, хранится изменение на основе пользователя.

## <a name="package-registry"></a><a href="" id="bkmk-pkg-registry"></a>Реестр пакетов


Прежде чем приложение сможет получить доступ к данным реестра пакетов, клиент App-V должен сделать данные реестра пакетов доступными для приложений. Клиент App-V использует реальный реестр как хранилище для всех данных реестра.

При добавлении нового пакета в клиент App-V копию реестра. DAT-файл из пакета создается по `%ProgramData%\Microsoft\AppV\Client\VREG\{Version GUID}.dat` . Имя файла — GUID версии с . Расширение DAT. Причина, по которой эта копия сделана, заключается в том, чтобы фактический файл улья в пакете никогда не используется, что предотвратит удаление пакета в более позднее время.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Registry.dat из магазина пакетов</strong></p></td>
<td align="left"><p><strong> &gt; </strong></p></td>
<td align="left"><p><strong>%ProgramData%\Microsoft\AppV\Client\Vreg{VersionGuid}.dat</strong></p></td>
</tr>
</tbody>
</table>

 

Когда первое приложение из пакета запущено на клиенте, клиент этапы или копии содержимого из файла улья, повторного создания данных реестра пакетов в альтернативном расположении `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AppV\Client\Packages\PackageGuid\Versions\VersionGuid\REGISTRY` . Данные поэтапного реестра отличаются двумя типами машинных данных и пользовательскими данными. Данные компьютера делятся между всеми пользователями на компьютере. Пользовательские данные постановлены для каждого пользователя в отдельное расположение `HKCU\Software\Microsoft\AppV\Client\Packages\PackageGuid\Registry\User` пользователя. Данные машины в конечном счете удаляются во время удаления пакета, а пользовательские данные удаляются при неопубликовке пользователя.

### <a name="package-registry-staging-vs-connection-group-registry-staging"></a>Постановка реестра пакетов и постановка реестра групп подключения

Когда присутствуют группы подключений, предыдущий процесс постановки реестра является верным, но вместо того, чтобы обрабатывать один файл улья, существует несколько. Файлы обрабатываются в порядке, в котором они отображаются в XML-группе подключения, при этом первый автор выигрывает любые конфликты.

Этапный реестр сохраняется так же, как и в случае одного пакета. Данные поэтапного реестра пользователей остаются для группы подключений до отключения; При удалении группы подключений удаляются данные реестра поэтапного компьютера.

### <a name="virtual-registry"></a>Виртуальный реестр

Целью виртуального реестра (VREG) является предоставление приложениям единого единого представления реестра пакетов и родного реестра. Она также предоставляет функции copy-on-write (COW), то есть любые изменения, внесенные в реестр из контекста виртуального процесса, в отдельное расположение COW. Это означает, что VREG должен объединить до трех отдельных местоположений реестра в одно представление на основе населенных расположений в реестре COW - &gt; пакет - &gt; родной. Когда будет сделан запрос на данные реестра, он будет находиться в порядке, пока не найдет запрашиваемую информацию. Это означает, что если в расположении COW хранится значение, оно не будет переназначяться в другие расположения, однако, если в расположении COW нет данных, оно будет переназначно в Пакет, а затем в расположение Native до тех пор, пока не найдет соответствующие данные.

### <a name="registry-locations"></a>Расположения реестра

Существует два расположения реестра пакетов и два расположения групп подключения, в которых клиент App-V хранит сведения о реестре в зависимости от того, публикуется ли пакет отдельно или в составе группы подключений. Существует три расположения COW для пакетов и три для групп подключений, созданных и управляемых VREG. Параметры для пакетов и групп подключения не являются общими:

**VReg единого пакета:**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Расположение</strong></p></td>
<td align="left"><p><strong>Описание</strong></p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>COW</strong></p></td>
<td align="left"><ul>
<li><p>Реестр машины\Клиент\Пакеты\PkgGUID\REGISTRY (только процесс повышения можно написать)</p></li>
<li><p>Реестр пользователей\Клиент\Пакеты\PkgGUID\REGISTRY (роуминг пользователей, написанный в HKCU, кроме Software\Classes</p></li>
<li><p>Классы реестра пользователей\Client\Packages\PkgGUID\REGISTRY (записи HKCU\Software\Classes и HKLM для неподъемного процесса)</p></li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Пакет</strong></p></td>
<td align="left"><ul>
<li><p>Реестр машины\Клиент\Пакеты\PkgGUID\Versions\VerGuid\Registry\Machine</p></li>
<li><p>Классы реестра пользователей\Client\Packages\PkgGUID\Versions\VerGUID\Registry</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Native</strong></p></td>
<td align="left"><ul>
<li><p>Расположение реестра родных приложений</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

 

**VReg группы подключения:**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><p><strong>Расположение</strong></p></td>
<td align="left"><p><strong>Описание</strong></p></td>
</tr>
<tr class="even">
<td align="left"><p><strong>COW</strong></p></td>
<td align="left"><ul>
<li><p>Реестр машины\Client\PackageGroups\GrpGUID\REGISTRY (только процесс повышения можно написать)</p></li>
<li><p>Реестр пользователей\Client\PackageGroups\GrpGUID\REGISTRY (все, что написано в HKCU, кроме Software\Classes</p></li>
<li><p>Классы реестра пользователей\Client\PackageGroups\GrpGUID\REGISTRY</p></li>
</ul></td>
</tr>
<tr class="odd">
<td align="left"><p><strong>Пакет</strong></p></td>
<td align="left"><ul>
<li><p>Реестр машины\Client\PackageGroups\GrpGUID\Versions\VerGUID\REGISTRY</p></li>
<li><p>Классы реестра пользователей\Client\PackageGroups\GrpGUID\Versions\VerGUID\REGISTRY</p></li>
</ul></td>
</tr>
<tr class="even">
<td align="left"><p><strong>Native</strong></p></td>
<td align="left"><ul>
<li><p>Расположение реестра родных приложений</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

 

Существует два расположения COW для HKLM; повышенные и неподъемные процессы. Повышенные процессы всегда записывают изменения HKLM в безопасную COW под HKLM. Неподъемные процессы всегда записывают изменения HKLM в небезопасную КОРОВу под HKCU\\Software\\Classes. Когда приложение читает изменения из HKLM, повышенные процессы будут читать изменения из безопасной коровы в HKLM. Неподъемные чтения из обоих, в пользу изменений, внесенных в unsecure COW в первую очередь.

### <a name="pass-through-keys"></a>Сквозные ключи

Сквозные ключи позволяют администратору настраивать определенные ключи, чтобы их можно было прочитать только из родного реестра, минуя расположения Пакета и COW. Проходные расположения являются глобальными для машины (не конкретного пакета) и могут быть настроены путем добавления пути к ключу, который следует рассматривать как сквозной к **REG\_MULTI\_SZ** значение под названием **PassThroughPaths** `HKLM\Software\Microsoft\AppV\Subsystem\VirtualRegistry` ключа . Любой ключ, который отображается в этом многоструновом значении (и их дети), будет рассматриваться как сквозной.

Следующие расположения по умолчанию настроены как проходные расположения:

-   HKEY\_CURRENT\_USER\\SOFTWARE\\Classes\\Local Параметры\\Software\\Microsoft\\\Windows\\CurrentVersion\\AppModel

-   HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Classes\\Local Параметры\\Software\\Microsoft\\Windows\\CurrentVersion\\AppModel

-   HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WINEVT

-   HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\services\\eventlog\\Application

-   HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger

-   HKEY\_CURRENT\_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Параметры

-   HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Perflib

-   HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Policies

-   HKEY\_CURRENT\_USER\\SOFTWARE\\Policies

Цель сквозных ключей заключается в том, чтобы виртуальное приложение не записывало данные реестра в VReg, необходимые для не-виртуальных приложений для успешной работы или интеграции. Ключ Политики гарантирует, что параметры групповой политики, установленные администратором, используются, а не для каждого параметра пакета. Ключ AppModel необходим для интеграции с Windows приложениями на основе пользовательского интерфейса. Рекомендуется, чтобы управляющие не меняли какие-либо из сквозных ключей по умолчанию, но в некоторых случаях в зависимости от поведения приложения может потребоваться добавление дополнительных сквозных ключей.

## <a name="app-v-package-store-behavior"></a><a href="" id="bkmk-pkg-store-behavior"></a>Поведение магазина пакетов App-V


App-V 5 управляет хранилищем пакетов, в котором хранятся расширенные файлы активов из файла appv. По умолчанию это расположение хранится в %ProgramData%\\App-V и ограничено с точки зрения возможностей хранения только свободным пространством диска. Хранилище пакетов организовано GUID-интерфейсами для пакета и версии, как упоминалось в предыдущем разделе.

### <a name="add-packages"></a>Добавление пакетов

Пакеты App-V будут поэтапно добавлены к компьютеру с клиентом App-V. Клиент App-V предоставляет по требованию постановку. Во время публикации или вручную add-AppVClientPackage структура данных строится в хранилище пакетов (c:\\programdata\\App-V\\{PkgGUID}\\{VerGUID}). Файлы пакетов, определенные в блоке публикации, определенном в StreamMap.xml, добавляются в систему, а папки верхнего уровня и детские файлы, которые будут размещены для обеспечения на момент запуска надлежащих ресурсов приложений.

### <a name="mounting-packages"></a>Пакеты монтажа

Пакеты могут быть явно загружены с помощью PowerShell или с помощью пользовательского интерфейса `Mount-AppVClientPackage` **клиента App-V** для скачивания пакета. Эта операция полностью загружает весь пакет в хранилище пакетов.

### <a name="streaming-packages"></a>Пакеты потоковой передачи

Клиент App-V можно настроить, чтобы изменить поведение потоковой передачи по умолчанию. Все политики потоковой передачи хранятся в следующем ключе реестра: `HKEY_LOCAL_MAcHINE\Software\Microsoft\AppV\Client\Streaming` . Политики задаются с помощью cmdlet `Set-AppvClientConfiguration` PowerShell. К потоковому потоку применяются следующие политики:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Политика</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>AllowHighCostLaunch</p></td>
<td align="left"><p>На Windows 8 и более поздней основе, он позволяет потоковой передачи через 3G и сотовые сети</p></td>
</tr>
<tr class="even">
<td align="left"><p>Автозагрузка</p></td>
<td align="left"><p>Указывает параметр фоновой нагрузки:</p>
<p><strong>0 </strong> - Отключено</p>
<p><strong>1 </strong> . Только ранее используемые пакеты</p>
<p><strong>2 </strong> . Все пакеты</p></td>
</tr>
<tr class="odd">
<td align="left"><p>PackageInstallationRoot</p></td>
<td align="left"><p>Корневая папка для хранения пакета в локальной машине</p></td>
</tr>
<tr class="even">
<td align="left"><p>PackageSourceRoot</p></td>
<td align="left"><p>Корневое переопределения, из которых должны передаваться пакеты</p></td>
</tr>
<tr class="odd">
<td align="left"><p>SharedContentStoreMode</p></td>
<td align="left"><p>Позволяет использовать общий хранилище контента для сценариев VDI</p></td>
</tr>
</tbody>
</table>

 

 

Эти параметры влияют на поведение потокового пакета App-V для клиента. По умолчанию App-V загружает только необходимые активы после загрузки начальных блоков публикации и основных функций. Существует три конкретных поведения вокруг потокового пакета, которые необходимо объяснить:

-   Фоновая потоковая передача

-   Оптимизация потоковой передачи

-   Недостатки потока

### <a name="background-streaming"></a>Фоновая потоковая передача

Для определения текущего режима фоновой потоковой передачи с помощью параметра AutoLoad и изменения с помощью cmdlet Set-AppvClientConfiguration или из реестра `Get-AppvClientConfiguration` (HKLM\\SOFTWARE\\Microsoft\\AppV\\ClientStreaming) можно использовать для определения текущего режима потоковой передачи фона. Фоновая потоковая передача — это параметр по умолчанию, в котором параметр Autoload устанавливается для загрузки ранее используемых пакетов. Поведение, основанное на параметре по умолчанию (значение=1), загружает блоки данных App-V в фоновом режиме после запуска приложения. Этот параметр можно отключить все вместе (значение=0) или включить для всех пакетов (значение=2), независимо от того, были ли они запущены.

### <a name="optimized-streaming"></a>Оптимизация потоковой передачи

Пакеты App-V можно настроить с помощью основного блока функций при секвенировании. Этот параметр позволяет инженеру по последовательности отслеживать запуск файлов для определенного приложения или приложений и отмечать блоки данных в пакете App-V для потоковой передачи при первом запуске любого приложения в пакете.

### <a name="stream-faults"></a>Ошибки потока

После первоначального потока данных публикации и основного блока функций запросы на дополнительные файлы выполняют ошибки потока. Эти блоки данных загружаются в хранилище пакетов по мере необходимости. Это позволяет пользователю скачивать только небольшую часть пакета, как правило, достаточно для запуска пакета и выполнения обычных задач. Все остальные блоки загружаются, когда пользователь инициирует операцию, которая требует данных, не хранимых в хранилище пакетов.

Дополнительные сведения о потоковом посещении потокового пакета App-V: <https://go.microsoft.com/fwlink/?LinkId=392770> .

Секвенирование для оптимизации потоковой передачи доступно по: <https://go.microsoft.com/fwlink/?LinkId=392771> .

### <a name="package-upgrades"></a>Обновления пакета

Пакеты App-V требуют обновления на протяжении всего жизненного цикла приложения. Обновления пакета App-V похожи на операцию публикации пакета, так как каждая версия будет создана в собственном расположении PackageRoot: `%ProgramData%\App-V\{PkgGUID}\{newVerGUID}` . Операция обновления оптимизирована путем создания жестких ссылок на идентичные и потоковые файлы из других версий того же пакета.

### <a name="package-removal"></a>Удаление пакета

Поведение клиента App-V при удалении пакетов зависит от метода, используемого для удаления. С помощью полной инфраструктуры App-V для разблокировки приложения файлы каталога пользователей (каталог машин для глобально опубликованных приложений) удаляются, но сохраняют расположение магазина пакетов и расположения COW. Когда для удаления пакета App-V используется комлет PowerShell, расположение магазина пакетов `Remove-AppVClientPackge` очищается. Помните, что неопубликовка пакета App-V с сервера управления не выполняет операцию Remove. Ни одна из операций не удаляет файлы пакета Package Store.

## <a name="roaming-registry-and-data"></a><a href="" id="bkmk-roaming-reg-data"></a>Реестр и данные в роуминге


App-V 5 может предоставлять практические возможности при роуминге в зависимости от того, как будет записано используемого приложения. По умолчанию App-V перемещает AppData, которая хранится в расположении роуминга, в зависимости от конфигурации роуминга операционной системы. Другие расположения для хранения данных на основе файлов не перемещаются с компьютера на компьютер, так как они находятся в местах, которые не перемещаются.

### <a name="roaming-requirements-and-user-catalog-data-storage"></a><a href="" id="bkmk-clt-inter-roam-reqs"></a>Требования к роумингу и хранению данных каталога пользователей

App-V хранит данные, которые представляют состояние каталога пользователя, в виде:

-   Файлы в %appdata%\\\Microsoft\\AppV\\Client\\Catalog

-   Параметры реестра под `HKEY_CURRENT_USER\Software\Microsoft\AppV\Client\Packages`

Вместе эти файлы и параметры реестра представляют каталог пользователя, поэтому оба должны перемещаться, либо не должны перемещаться для данного пользователя. App-V не поддерживает роуминг %AppData%, но не роуминг профиля пользователя (реестра) или наоборот.

**Примечание.**  
Комлет **Repair-AppvClientPackage** не ремонтирует состояние публикации пакетов, в котором состояние App-V пользователя отсутствует или несоизмеряется с данными в `HKEY_CURRENT_USER` %appdata%.

 

### <a name="registry-based-data"></a>Данные на основе реестра

Роуминг реестра App-V подпадает под два сценария, как показано в следующей таблице.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Сценарий</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Приложения, которые запускаются в качестве стандартных пользователей</p></td>
<td align="left"><p>Когда стандартный пользователь запускает приложение App-V, приложения HKLM и HKCU для App-V хранятся в улье HKCU на компьютере. Это представляет в качестве двух различных путей:</p>
<ul>
<li><p>HKLM: HKCU\SOFTWARE\Classes\AppV\Client\Packages{PkgGUID}\REGISTRY\MACHINE\SOFTWARE</p></li>
<li><p>HKCU: HKCU\SOFTWARE\Microsoft\AppV\Client\Packages{PkgGUID}\REGISTRY\USER{UserSID}\SOFTWARE</p></li>
</ul>
<p>Расположение включено для роуминга в зависимости от параметров операционной системы.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Приложения, которые запускаются с высотой</p></td>
<td align="left"><p>При запуске приложения с высотой:</p>
<ul>
<li><p>Данные HKLM хранятся в улье HKLM на локальном компьютере</p></li>
<li><p>Данные HKCU хранятся в расположении реестра пользователей</p></li>
</ul>
<p>В этом сценарии эти параметры не перемещаются с нормальной конфигурацией роуминга операционной системы, а в результате ключи и значения реестра хранятся в следующем расположении:</p>
<ul>
<li><p>HKLM\SOFTWARE\Microsoft\AppV\Client\Packages{PkgGUID}{UserSID}\REGISTRY\MACHINE\SOFTWARE</p></li>
<li><p>HKCU\SOFTWARE\Microsoft\AppV\Client\Packages{PkgGUID}\Registry\User{UserSID}\SOFTWARE</p></li>
</ul></td>
</tr>
</tbody>
</table>

 

### <a name="app-v-and-folder-redirection"></a>Перенаправление app-V и папок

App-V 5.1 поддерживает перенаправление папок в роуминговую папку AppData (%AppData%). Когда виртуальная среда запущена, состояние роуминга AppData из роуминга каталога AppData пользователя копируется в локальный кэш. И наоборот, при закрытии виртуальной среды локальный кэш, связанный с роумингом AppData определенного пользователя, передается в фактическое расположение роуминга каталога AppData этого пользователя.

В обычном пакете имеется несколько местоположений, относяющихся к запасной части пользователя для параметров в AppData\\Local и AppData\\Roaming. Это расположения Copy on Write, которые хранятся на каждого пользователя в профиле пользователя и используются для хранения изменений в каталогах VFS пакета и защиты VFS пакета по умолчанию.

В следующей таблице показаны локальные и роуминг-расположения, когда перенаправление папок не реализовано.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Каталог VFS в пакете</th>
<th align="left">Mapped location of backing store</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>ProgramFilesX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \ProgramFilesX86</p></td>
</tr>
<tr class="even">
<td align="left"><p>SystemX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \SystemX86</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \Windows</p></td>
</tr>
<tr class="even">
<td align="left"><p>appv_ROOT</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \appv_ROOT</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AppData</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; roaming </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \AppData</p></td>
</tr>
</tbody>
</table>

 

 

В следующей таблице показаны локальные и роуминговые расположения, когда перенаправление папок реализовано для %AppData%, а расположение было перенаправлено (как правило, в расположение сети).

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Каталог VFS в пакете</th>
<th align="left">Mapped location of backing store</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>ProgramFilesX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \ProgramFilesX86</p></td>
</tr>
<tr class="even">
<td align="left"><p>SystemX86</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \SystemX86</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Windows</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \Windows</p></td>
</tr>
<tr class="even">
<td align="left"><p>appv_ROOT</p></td>
<td align="left"><p>C:\users\jsmith\AppData &lt; strong &gt; Local </strong> \Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \appv_ROOT</p></td>
</tr>
<tr class="odd">
<td align="left"><p>AppData</p></td>
<td align="left"><p><strong>\Fileserver </strong> \users\jsmith\roaming\Microsoft\AppV\Client\VFS &amp; lt; GUID &gt; \AppData</p></td>
</tr>
</tbody>
</table>

 

 

Текущий драйвер VFS клиента App-V не может записываться в сетевые расположения, поэтому клиент App-V обнаруживает наличие перенаправления папок и копирует данные на локальном диске во время публикации и при старте виртуальной среды. После того как пользователь закрывает приложение App-V и клиент App-V закрывает виртуальную среду, локальное хранилище VFS AppData копируется обратно в сеть, что позволяет перемещаться на дополнительные машины, где процесс будет повторяться. Подробные действия процессов:

1.  Во время публикации или запуска виртуальной среды клиент App-V определяет расположение каталога AppData.

2.  Если маршрут роуминга AppData локализуется или расположение AppData\\Roaming является локальным, ничего не происходит.

3.  Если путь к роумингу AppData не является локальным, каталог VFS AppData соотносят с локальным каталогом AppData.

Этот процесс решает проблему неместного %AppData%, который не поддерживается драйвером VFS клиента App-V. Однако данные, хранимые в этом новом расположении, не перемещаются с перенаправлением папок. Все изменения во время работы приложения происходят в локальном расположении AppData и должны быть скопированы в перенаправленные расположения. Подробные действия этого процесса:

1.  Приложение App-V закрывается, что закрывает виртуальную среду.

2.  Локальный кэш расположения роуминга AppData сжат и хранится в файле ZIP.

3.  Для имени файла используется timestamp в конце процесса упаковки ZIP.

4.  Время записи в реестре: HKEY\_CURRENT\_USER\\Software\\Microsoft\\AppV\\Client\\Packages\\ &lt; GUID &gt; \\AppDataTime как последний известный timestamp AppData.

5.  Процесс перенаправления папок вызван для оценки и инициации файла ZIP, загруженного в роуминговом каталоге AppData.

Период времени используется для определения сценария "последний автор выигрывает", если имеется конфликт, и используется для оптимизации скачивания данных при публикации приложения App-V или в виртуальной среде. Перенаправление папок сделает данные доступными для всех других клиентов, охваченных политикой поддержки, и инициирует процесс хранения данных AppData\\Roaming в локальном расположении AppData на клиенте. Подробные процессы:

1.  Пользователь запускает виртуальную среду, запуская приложение.

2.  Виртуальная среда приложения проверяет последний почтовый файл, если он присутствует.

3.  Реестр проверяется на наличие последнего известного загруженного времени.

4.  Последний файл ZIP скачивается, если локальный последний известный период загрузки не превышает или не равен времени из zip-файла.

5.  Если локальное время последней известной загрузки превышает время последнего zip-файла в роуминговом расположении AppData, файл ZIP извлекается в локальный временный каталог в профиле пользователя.

6.  После успешного извлечения файла ZIP локальный кэш роумингового каталога AppData переименован и новые данные будут перенесены на место.

7.  Переименованный каталог удаляется, и приложение открывается с помощью недавно сохраненных данных AppData в роуминге.

Это завершает успешное роуминг параметров приложений, присутствующих в расположениях AppData\\Roaming. Единственным другим условием, которое необходимо устранить, является операция по ремонту пакета. Сведения о процессе:

1.  Во время ремонта укажи, не является ли путь к роумингу каталога AppData пользователя локальным.

2.  На карте неместного роуминга цели пути AppData воссозданы ожидаемые расположения в роуминге и локальные расположения AppData.

3.  Удалите временную запись, храняную в реестре, если она присутствует.

Этот процесс позволит повторно создать локальные и сетевые расположения Для AppData и удалить запись реестра timestamp.

## <a name="app-v-client-application-lifecycle-management"></a><a href="" id="bkmk-clt-app-lifecycle"></a>Управление жизненным циклом клиентских приложений App-V


В полной инфраструктуре App-V после последовательной последовательности приложений они управляются и публикуются пользователям или компьютерам с помощью серверов управления и публикации App-V. В этом разделе подробно изданы операции, которые происходят во время общих операций жизненного цикла приложений App-V (Добавление, публикация, запуск, обновление и удаление), а также расположения файлов и реестров, которые изменены и изменены с точки зрения клиента App-V. Операции клиента App-V выполняются в качестве серии команд PowerShell, инициированных на компьютере с клиентом App-V.

В этом документе основное внимание уделяется решениям для полной инфраструктуры App-V. Сведения об интеграции App-V с диспетчером конфигурации 2012: <https://go.microsoft.com/fwlink/?LinkId=392773> .

Задачи жизненного цикла приложения App-V запускаются при входе пользователя (по умолчанию), запуске машины или в качестве операций с фоновым временем. Параметры для клиентских операций App-V, включая серверы публикации, интервалы обновления, включить сценарий пакетов и другие, настраиваются при настройке клиента или после установки с помощью команд PowerShell. См. раздел Как развернуть клиентский раздел в TechNet: Как развернуть [клиент App-V](how-to-deploy-the-app-v-client-51gb18030.md) или использовать PowerShell:

```powershell
get-command *appv*
```

### <a name="publishing-refresh"></a>Обновление публикации

Процесс обновления публикации состоит из нескольких небольших операций, выполняемых на клиенте App-V. Так как App-V — это технология виртуализации приложений, а не технология планирования задач, Windows планировщик задач используется для запуска процесса при логоуне пользователя, запуске машины и в запланированные промежутки времени. Конфигурация клиента во время настройки, перечисленных выше, является предпочтительным методом при распространении клиента на большую группу компьютеров с правильными настройками. Эти параметры клиента можно настроить с помощью следующих cmdlets PowerShell:

-   **Add-AppVPublishingServer:** Настраивает клиента с помощью издательского сервера App-V, который предоставляет пакеты App-V.

-   **Set-AppVPublishingServer:** Изменяет текущие параметры для сервера публикации App-V.

-   **Set-AppVClientConfiguration:** Изменяет параметры токов для клиента App-V.

-   **Sync-AppVPublishingServer:** Инициирует процесс обновления публикации App-V вручную. Это также используется в запланированных задачах, созданных при настройке сервера публикации.

В следующих разделах основное внимание уделяется детализации операций, которые происходят на различных этапах обновления публикации App-V. Темы:

-   Добавление пакета App-V

-   Публикация пакета App-V

### <a name="adding-an-app-v-package"></a>Добавление пакета App-V

Добавление пакета App-V в клиент является первым этапом процесса обновления публикации. Конечный результат такой же, как и в `Add-AppVClientPackage` cmdlet в PowerShell, за исключением процесса добавления обновления публикации, настроенный сервер публикации получает контакт и передает клиенту список приложений высокого уровня, чтобы получить более подробные сведения, а не операцию добавления пакета. Процесс продолжается путем настройки клиента для пакетов или дополнений или обновлений групп подключения, а затем получает доступ к файлу appv. Далее содержимое файла appv расширяется и помещается в локализованную операционную систему в соответствующих расположениях. Ниже приводится подробный рабочий процесс процесса, если предположить, что пакет настроен для потоковой передачи ошибок.

**Добавление пакета App-V**

1.  Ручное инициация с помощью PowerShell или последовательности задач в процессе обновления публикации.

    1.  Клиент App-V создает подключение HTTP и запрашивает список приложений, основанных на целевом объекте. Процесс обновления публикации поддерживает ориентацию машин или пользователей.

    2.  Издательский сервер App-V использует удостоверение цели, пользователя или машины и запрашивает базу данных для списка приложений, имеющих право. Список приложений предоставляется в качестве XML-ответа, который клиент использует для отправки дополнительных запросов на сервер для получения дополнительных сведений на основе каждого пакета.

2.  Агент публикации в клиенте App-V выполняет все действия ниже сериализованного.

    Оцените все группы подключений, которые неопубликовывались или отключены, так как обновления версий пакетов, которые являются частью группы подключения, не могут быть обработаны.

3.  Настройка пакетов путем определения операций Добавить или Обновить.

    1.  Клиент App-V использует API AppX из Windows и получает доступ к файлу appv с издательского сервера.

    2.  Файл пакета открыт, а AppXManifest.xml StreamMap.xml загружается в хранилище пакетов.

    3.  Полностью поток публикации блок данных, определенных в StreamMap.xml. Хранит данные блока публикации в хранилище пакетов\\PkgGUID\\VerGUID\\Root.

        -   Значки: цели точек расширения.

        -   Портативные заготчики для выполнения (PE Headers): целевые объекты точек расширения, содержащие базовую информацию о потребности изображения на диске, непосредственном доступе или типах файлов.

        -   Сценарии. Скачайте каталог скриптов для использования в процессе публикации.

    4.  Заполнять магазин пакетов:

        1.  Создайте редкие файлы на диске, которые представляют извлеченный пакет для всех перечисленных каталогов.

        2.  Этап файлов и каталогов верхнего уровня под корнем.

        3.  Все остальные файлы создаются, когда каталог указан как разреженный на диске и будет передаваться по запросу.

    5.  Создание записей каталога машин. Создайте Manifest.xml и DeploymentConfiguration.xml из пакетных файлов (если DeploymentConfiguration.xml в пакете не создается местообладатель).

    6.  Создание расположения магазина пакетов в реестре HKLM\\Software\\Microsoft\\AppV\\Client\\Packages\\PkgGUID\\Versions\\VerGUID\\Catalog

    7.  Создание файла Registry.dat из магазина пакетов в %ProgramData%\\\Microsoft\\AppV\\Client\\VReg\\{VersionGUID}.dat

    8.  Регистрация пакета с помощью драйвера режима Ядра App-V HKLM\\\Microsoft\\Software\\AppV\\MAV

    9.  Вызов скриптов из AppxManifest.xml или DeploymentConfig.xml для времени добавления пакета.

4.  Настройка групп подключения путем добавления и включения или отключения.

5.  Удалите объекты, не опубликованные целевому объекту (пользователю или компьютеру).

    **Примечание.**  
    Это не будет выполнять удаление пакета, а удаляет точки интеграции для определенной цели (пользователя или машины) и удаляет файлы каталога пользователей (файлы каталога машин для глобальной публикации).

     

6.  Вызов фоновой нагрузки на основе конфигурации клиента.

7.  Пакеты, которые уже имеют сведения о публикации для компьютера или пользователя, немедленно восстанавливаются.

    **Примечание.**  
    Это условие возникает в качестве продукта удаления без неопубликовки с добавлением фона пакета.

     

Это завершает добавление пакета App-V процесса обновления публикации. Следующий шаг — публикация пакета для определенной цели (машины или пользователя).

![пакет добавить данные файла и реестра.](images/packageaddfileandregistrydata.png)

### <a name="publishing-an-app-v-package"></a>Публикация пакета App-V

Во время операции Обновления публикации определенная операция публикации (Publish-AppVClientPackage) добавляет записи в каталог пользователей, определяет право на карты пользователя, определяет локальный магазин и завершается выполнением любых этапов интеграции. Ниже описаны подробные действия.

**Публикация и пакет App-V**

1.  Записи пакетов добавляются в каталог пользователей

    1.  Целевые пакеты пользователей: UserDeploymentConfiguration.xml и UserManifest.xml помещаются на компьютере в каталоге пользователей

    2.  Пакеты машинного таргетного (глобального) UserDeploymentConfiguration.xml помещаются в каталог машин

2.  Регистрация пакета с драйвером режима ядра для пользователя в HKLM\\Software\\Microsoft\\AppV\\MAV

3.  Выполнение задач интеграции.

    1.  Создание точек расширения.

    2.  Хранение данных резервного копирования в реестре пользователя и в профиле роуминга (Shortcut Backups).

        **Примечание.**  
        Это позволяет восстановить точки расширения, если пакет неопубликован.

         

    3.  Запуск скриптов, нацеленных на время публикации.

Публикация пакета App-V, который входит в группу подключений, очень похожа на вышеуказанный процесс. Для групп подключений путь, в который хранится определенная информация о каталоге, включает PackageGroups в качестве ребенка каталога. Просмотрите сведения о каталоге компьютера и пользователей, которые были выше.

![пакет добавить данные файла и реестра — глобальный.](images/packageaddfileandregistrydata-global.png)

### <a name="application-launch"></a>Запуск приложения

После процесса обновления публикации пользователь запускает и повторно запускает приложение App-V. Процесс очень прост и оптимизирован для быстрого запуска с минимальным сетевым трафиком. Клиент App-V проверяет путь к каталогу пользователей для файлов, созданных во время публикации. После создания прав на запуск пакета клиент App-V создает виртуальную среду, начинает потоковую передачу необходимых данных и применяет соответствующие файлы конфигурации манифеста и развертывания во время создания виртуальной среды. С помощью виртуальной среды, созданной и настроенной для определенного пакета и приложения, приложение запускается.

**Запуск приложений App-V**

1.  Пользователь запускает приложение, щелкнув вызов ярлыка или типа файла.

2.  Клиент App-V проверяет существование в каталоге пользователей для следующих файлов

    -   UserDeploymentConfiguration.xml

    -   UserManifest.xml

3.  Если файлы присутствуют, приложение имеет право для этого конкретного пользователя, и приложение запустит процесс запуска. На данный момент сетевой трафик не существует.

4.  Далее клиент App-V проверяет, что путь для пакета, зарегистрированного для клиентской службы App-V, находится в реестре.

5.  После поиска пути в хранилище пакетов создается виртуальная среда. Если это первый запуск, основной блок функций загружается, если он присутствует.

6.  После загрузки клиентская служба App-V потребляет файлы конфигурации манифеста и развертывания для настройки виртуальной среды и загрузки всех подсистем App-V.

7.  Запускается приложение. Для любых отсутствующих файлов в хранилище пакетов (редкие файлы) App-V будет передавать ошибки файлов по мере необходимости.

    ![пакет добавить данные файла и реестра - поток.](images/packageaddfileandregistrydata-stream.png)

### <a name="upgrading-an-app-v-package"></a>Обновление пакета App-V

Процесс обновления пакета App-V 5 отличается от старых версий App-V. App-V поддерживает несколько версий одного и того же пакета на машине, которая имеет право на доступ к разным пользователям. Пакетные версии можно добавлять в любое время по мере обновления магазина пакетов и каталогов новыми ресурсами. Единственным процессом, характерным для добавления новых ресурсов версии, является оптимизация хранилища. Во время обновления в расположение магазина новой версии добавляются только новые файлы, а для неизмененных файлов создаются жесткие ссылки. Это уменьшает общее хранилище, только презентовыв файл на одном расположении диска, а затем проецив его во все папки с записью расположения файла на диске. Конкретные сведения об обновлении пакета App-V следуют следующим образом:

**Обновление пакета App-V**

1.  Клиент App-V выполняет обновление публикации и обнаруживает более новую версию пакета App-V.

2.  Записи пакета добавляются в соответствующий каталог для новой версии

    1.  Целевые пакеты пользователей: UserDeploymentConfiguration.xml и UserManifest.xml помещаются на компьютер в каталоге пользователей в appdata\\roaming\\Microsoft\\AppV\\Client\\Catalog\\Packages\\PkgGUID\\VerGUID

    2.  Целевые пакеты машин: UserDeploymentConfiguration.xml помещается в каталог машины на уровне %programdata%\\Microsoft\\AppV\\Client\\Catalog\\Packages\\PkgGUID\\VerGUID

3.  Регистрация пакета с драйвером режима ядра для пользователя в HKLM\\Software\\Microsoft\\AppV\\MAV

4.  Выполнение задач интеграции.

    -   Интеграция точек расширения (EP) из файлов Manifest и Dynamic Configuration.

    1.  Данные EP на основе файлов хранятся в папке AppData с использованием точек соединения из магазина пакетов.

    2.  EPs версии 1 уже существует, когда становится доступной новая версия.

    3.  Точки расширения переключаются на расположение Версии 2 в машинных или пользовательских каталогах для любых более новых или обновленных точек расширения.

5.  Запуск скриптов, нацеленных на время публикации.

6.  Установите сборки бок о бок по мере необходимости.

### <a name="upgrading-an-in-use-app-v-package"></a>Обновление используемого пакета App-V

**Начиная с Приложения-V 5 SP2.** Если вы пытаетесь обновить пакет, который используется конечным пользователем, задача обновления помещается в ожидаемом состоянии. Обновление будет работать позже, в соответствии со следующими правилами:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Тип задачи</th>
<th align="left">Применимое правило</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Задача на основе пользователя, например публикация пакета пользователю</p></td>
<td align="left"><p>Ожидаемая задача будет выполнена после того, как пользователь выключит журнал, а затем снова войдите в систему.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Глобальная задача, например включение группы подключений по всему</p></td>
<td align="left"><p>Ожидаемая задача будет выполнена после отключения компьютера и его перезапуска.</p></td>
</tr>
</tbody>
</table>

 

При размещении задачи в ожидаемом состоянии клиент App-V также создает ключ реестра для ожидаемой задачи следующим образом:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Задача, основанная на пользователях или глобальной основе</th>
<th align="left">Где создается ключ реестра</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Задачи, основанные на пользователях</p></td>
<td align="left"><p>KEY_CURRENT_USER\Software\Microsoft\AppV\Client\PendingTasks</p></td>
</tr>
<tr class="even">
<td align="left"><p>Задачи на глобальном уровне</p></td>
<td align="left"><p>HKEY_LOCAL_MACHINE\Software\Microsoft\AppV\Client\PendingTasks</p></td>
</tr>
</tbody>
</table>

 

Необходимо завершить следующие операции, прежде чем пользователи смогут использовать более новую версию пакета:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Задача</th>
<th align="left">Сведения</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Добавление пакета на компьютер</p></td>
<td align="left"><p>Эта задача является компьютерной, и вы можете выполнить ее в любое время, завершив действия в разделе Добавить пакет выше.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Публикация пакета</p></td>
<td align="left"><p>См. в разделе Публикация пакета выше для действий. Этот процесс требует обновления точек расширения в системе. Конечные пользователи не могут использовать приложение при завершении этой задачи.</p></td>
</tr>
</tbody>
</table>

 

Используйте следующие сценарии примера в качестве руководства для обновления пакетов.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Сценарий</th>
<th align="left">Требования</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Пакет App-V не используется при попытке обновления</p></td>
<td align="left"><p>Ни один из следующих компонентов пакета не может быть в использовании: виртуальное приложение, com-сервер или расширения оболочки.</p>
<p>Администратор публикует более новую версию пакета, и обновление работает при следующем запуске компонента или приложения внутри пакета. Новая версия пакета будет транслироваться и запускаться. Ничего не изменилось в этом сценарии в App-V 5 SP2 из предыдущих выпусков App-V 5.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Пакет App-V используется, когда администратор публикует более новую версию пакета</p></td>
<td align="left"><p>Операция обновления настроена на ожидание клиентом App-V, что означает, что она находится в очереди и проводится позже, когда пакет не используется.</p>
<p>Если приложение пакета используется, пользователь закрывает виртуальное приложение, после чего может произойти обновление.</p>
<p>Если пакет имеет расширения оболочки (Office 2013), которые постоянно загружаются Windows Explorer, пользователь не может войти в систему. Чтобы инициировать обновление пакета App-V, пользователям необходимо выйти из системы и вернуться в систему.</p></td>
</tr>
</tbody>
</table>

 

### <a name="global-vs-user-publishing"></a>Глобальное и пользовательское публикация

Пакеты App-V можно публиковать одним из двух способов; Пользователь, который дает право пакету App-V определенному пользователю или группе пользователей и глобальному, который дает право пакету App-V на всю машину для всех пользователей машины. После обновления пакета и не используется пакет App-V, рассмотрите два типа публикации:

-   **Глобально опубликовано:** приложение публикуется на компьютере; Все пользователи на этом компьютере могут использовать его. Обновление произойдет при запуске клиентской службы App-V, что фактически означает перезапуск машины.

-   **Пользователь опубликован:** приложение публикуется пользователю. Если на компьютере несколько пользователей, приложение может быть опубликовано в подмножество пользователей. Обновление произойдет при повторном входе пользователя или при повторной публикации (периодические обновления и оценки политики ConfigMgr или периодического публикации/обновления App-V или явно с помощью команд PowerShell).

### <a name="removing-an-app-v-package"></a>Удаление пакета App-V

Удаление приложений App-V в полной инфраструктуре является неопубликоваемой операцией и не выполняет удаление пакета. Процесс такой же, как и процесс публикации выше, но вместо добавления процесса удаления отменяются изменения, внесенные для пакетов App-V.

### <a name="repairing-an-app-v-package"></a>Восстановление пакета App-V

Операция по ремонту очень проста, но может повлиять на многие расположения на машине. Ранее упомянутые расположения Copy on Write (COW) удаляются, а точки расширения де-интегрированы, а затем повторно интегрированы. Просмотрите расположения размещения данных COW, просмотрев, где они зарегистрированы в реестре. Эта операция осуществляется автоматически, и нет административного управления, кроме инициации операции восстановления из клиентской консоли App-V или с помощью PowerShell (Repair-AppVClientPackage).

## <a name="integration-of-app-v-packages"></a><a href="" id="bkmk-integr-appv-pkgs"></a>Интеграция пакетов App-V


Архитектура клиента и пакета App-V обеспечивает определенную интеграцию с локальной операционной системой во время добавления и публикации пакетов. Три файла определяют точки интеграции или расширения пакета App-V:

-   AppXManifest.xml: хранится внутри пакета с запасными копиями, хранимыми в хранилище пакета и профиле пользователя. Содержит параметры, созданные в процессе секвенации.

-   DeploymentConfig.xml. Предоставляет сведения о конфигурации точек расширения интеграции на основе компьютера и пользователя.

-   UserConfig.xml: подмножество Deploymentconfig.xml, которое предоставляет только пользовательские конфигурации и нацелено только на точки расширения на основе пользователя.

### <a name="rules-of-integration"></a>Правила интеграции

Когда приложения App-V публикуются на компьютере с клиентом App-V, некоторые конкретные действия, как описано в приведенном ниже списке:

-   Глобальная публикация. Ярлыки хранятся в расположении профиля "Все пользователи", а другие точки расширения хранятся в реестре в улье HKLM.

-   Публикация пользователей. Ярлыки хранятся в профиле текущей учетной записи пользователя, а другие точки расширения хранятся в реестре в улье HKCU.

-   Резервное копирование и восстановление. Существующие данные и реестры приложений (например, регистрации FTA) резервное копирование во время публикации.

    1.  Пакеты App-V передаются в собственность на основе последнего интегрированного пакета, в котором право собственности передается в самое новое опубликованное приложение App-V.

    2.  При неопубликовываемом пакете App-V право собственности передается из одного пакета App-V в другой. Это не будет инициировать восстановление данных или реестра.

    3.  Восстановление восстановленных данных при неопубликовываемом или удалении последнего пакета на основе точки расширения.

### <a name="extension-points"></a>Точки расширения

Файлы публикации App-V (манифест и динамическая конфигурация) предоставляют несколько точек расширения, которые позволяют приложению интегрироваться с локальной операционной системой. Эти точки расширения выполняют типичные задачи установки приложений, такие как размещение ярлыков, создание ассоциаций типов файлов и регистрация компонентов. Поскольку это виртуализированные приложения, которые не установлены таким же образом, как традиционное приложение, существуют некоторые различия. Ниже приводится список точек расширения, охватываемых в этом разделе:

-   Ярлыки

-   Ассоциации типов файлов

-   Расширения shell

-   COM

-   Клиенты программного обеспечения

-   Возможности приложения

-   Обработник протокола URL-адреса

-   AppPath

-   Виртуальное приложение

### <a name="shortcuts"></a>Ярлыки

Короткий отрезок является одним из основных элементов интеграции с ОС и является интерфейсом для запуска приложения App-V для непосредственного пользователя. Во время публикации и неопубликовки приложений App-V.

Из манифеста пакета и динамических XML-файлов конфигурации путь к определенному исполняемого приложения можно найти в разделе, аналогичном следующему:

```xml
<Extension Category="AppV.Shortcut">
          <Shortcut>
            <File>[{Common Desktop}]\Adobe Reader 9.lnk</File>
            <Target>[{AppVPackageRoot}]\Reader\AcroRd32.exe</Target>
            <Icon>[{Windows}]\Installer\{AC76BA86-7AD7-1033-7B44-A94000000001}\SC_Reader.ico</Icon>
            <Arguments />
            <WorkingDirectory />
            <ShowCommand>1</ShowCommand>
            <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
          </Shortcut>
        </Extension>
```

Как упоминалось ранее, ярлыки App-V по умолчанию размещаются в профиле пользователя на основе операции обновления. Глобальное обновление помещает ярлыки в профиле "Все пользователи", а пользователь сохраняет их в профиле конкретного пользователя. Фактический исполняемый хранится в хранилище пакетов. Расположение ICO-файла является маркеризированным расположением в пакете App-V.

### <a name="file-type-associations"></a>Ассоциации типов файлов

Клиент App-V управляет локальными ассоциациями типов файлов операционной системы во время публикации, что позволяет пользователям использовать вызовы типа файлов или открывать файл с специально зарегистрированным расширением (.docx) для запуска приложения App-V. Ассоциации типов файлов присутствуют в файлах манифеста и динамической конфигурации, как представлено в примере ниже:

```xml
<Extension Category="AppV.FileTypeAssociation">
          <FileTypeAssociation>
            <FileExtension MimeAssociation="true">
              <Name>.xdp</Name>
              <ProgId>AcroExch.XDPDoc</ProgId>
              <ContentType>application/vnd.adobe.xdp+xml</ContentType>
            </FileExtension>
            <ProgId>
              <Name>AcroExch.XDPDoc</Name>
              <Description>Adobe Acrobat XML Data Package File</Description>
              <EditFlags>65536</EditFlags>
              <DefaultIcon>[{Windows}]\Installer\{AC76BA86-7AD7-1033-7B44-A94000000001}\XDPFile_8.ico</DefaultIcon>
              <ShellCommands>
                <DefaultCommand>Read</DefaultCommand>
                <ShellCommand>
                  <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
                  <Name>Open</Name>
                  <CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe" "%1"</CommandLine>
                </ShellCommand>
                <ShellCommand>
                  <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
                  <Name>Printto</Name>
                  <CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe"  /t "%1" "%2" "%3" "%4"</CommandLine>
                </ShellCommand>
                <ShellCommand>
                  <ApplicationId>[{AppVPackageRoot}]\Reader\AcroRd32.exe</ApplicationId>
                  <Name>Read</Name>
                  <FriendlyName>Open with Adobe Reader 9</FriendlyName>
                  <CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe" "%1"</CommandLine>
                </ShellCommand>
              </ShellCommands>
            </ProgId>
          </FileTypeAssociation>
        </Extension>
```

**Примечание.**  
В этом примере:

-   `<Name>.xdp</Name>` является расширением

-   `<Name>AcroExch.XDPDoc</Name>` это значение ProgId (которое указывает на прилегающий ProgId)

-   `<CommandLine>"[{AppVPackageRoot}]\Reader\AcroRd32.exe" "%1"</CommandLine>` — командная строка, которая указывает на приложение, исполняемое

 

### <a name="shell-extensions"></a>Расширения оболочки

Расширения shell автоматически встраиваются в пакет во время процесса секвенации. При глобальной публикации пакета расширение оболочки предоставляет пользователям те же функции, что и локальное установку приложения. Приложение не требует дополнительной настройки или конфигурации клиента, чтобы включить функции расширения оболочки.

**Требования к использованию расширений оболочки:**

-   Пакеты, содержащие встроенные расширения оболочки, должны публиковаться глобально.

-   "Битность" клиента приложения, секвенсора и App-V должна соответствовать, иначе расширения оболочки не будут работать. Пример:

    -   Версия приложения 64-битная.

    -   Секвенсор работает на 64-битных компьютерах.

    -   Пакет доставляется на 64-битный клиентский компьютер App-V.

В следующей таблице отображаются поддерживаемые расширения оболочки.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Обработник</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Обработник меню контекста</p></td>
<td align="left"><p>Добавляет элементы меню в контекстное меню. Он вызван перед отображением контекстного меню.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработник перетаскивания</p></td>
<td align="left"><p>Управляет действием правой кнопкой мыши перетаскивания и изменяет контекстное меню, которое отображается.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Drop target handler</p></td>
<td align="left"><p>Управление действием после того, как объект данных перетаскивали и опускали над объектом падения, например файлом.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработник объекта данных</p></td>
<td align="left"><p>Управление действием после копирования файла в буфер обмена данными или перетаскиванием и сбросом над целевой целью сброса. Он может предоставить дополнительные форматы буфера обмена данными для цели падения.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработник листа свойств</p></td>
<td align="left"><p>Заменяет или добавляет страницы в диалоговое окно листа свойств объекта.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработщик Infotip</p></td>
<td align="left"><p>Позволяет получить флажки и infotip для элемента и отобразить его в всплывающее средство при наведении мыши.</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработник столбцов</p></td>
<td align="left"><p>Позволяет создавать и отображать настраиваемые столбцы в представлении Windows Explorer <em> Details </em> . Его можно использовать для расширения сортировки и группировки.</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработник предварительного просмотра</p></td>
<td align="left"><p>Включает предварительный просмотр файла, отображаемого в Windows области предварительного просмотра обозревателя.</p></td>
</tr>
</tbody>
</table>

 

### <a name="com"></a>COM

Клиент App-V поддерживает публикацию приложений с поддержкой интеграции и виртуализации COM. Интеграция COM позволяет клиенту App-V регистрировать объекты COM в локальной операционной системе и виртуализацию объектов. Для целей этого документа интеграция объектов COM требует дополнительных деталей.

App-V поддерживает регистрацию com-объектов из пакета в локализованную операционную систему с двумя типами процессов: вне процесса и в процессе. Регистрация объектов COM выполняется с помощью одного или нескольких режимов работы для определенного пакета App-V, который включает отключенные, изолированные и интегрированные. Интегрированный режим настраивается как для вне процесса, так и для типа в процессе. Конфигурация режимов и типов COM выполняется с помощью динамических файлов конфигурации (deploymentconfig.xml или userconfig.xml).

Сведения об интеграции App-V доступны по: <https://go.microsoft.com/fwlink/?LinkId=392834> .

### <a name="software-clients-and-application-capabilities"></a>Клиенты программного обеспечения и возможности приложений

App-V поддерживает конкретные клиенты программного обеспечения и точки расширения возможностей приложений, которые позволяют регистрировать виртуализированные приложения с клиентом программного обеспечения операционной системы. Это позволяет пользователям выбирать программы по умолчанию для таких операций, как электронная почта, мгновенные сообщения и медиа-плеер. Эта операция выполняется на панели управления с набором доступа к программам и по умолчанию компьютера и настраивается во время последовательного выполнения в файлах манифеста или динамической конфигурации. Возможности приложений поддерживаются только при глобальной публикации приложений App-V.

Пример регистрации клиентского программного обеспечения почтового клиента на основе App-V.

```xml
    <SoftwareClients Enabled="true">
      <ClientConfiguration EmailEnabled="true" />
      <Extensions>
        <Extension Category="AppV.SoftwareClient">
          <SoftwareClients>
            <EMail MakeDefault="true">
              <Name>Mozilla Thunderbird</Name>
              <Description>Mozilla Thunderbird</Description>
              <DefaultIcon>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe,0</DefaultIcon>
              <InstallationInformation>
                <RegistrationCommands>
                  <Reinstall>"[{ProgramFilesX86}]\Mozilla Thunderbird\uninstall\helper.exe" /SetAsDefaultAppGlobal</Reinstall>
                  <HideIcons>"[{ProgramFilesX86}]\Mozilla Thunderbird\uninstall\helper.exe" /HideShortcuts</HideIcons>
                  <ShowIcons>"[{ProgramFilesX86}]\Mozilla Thunderbird\uninstall\helper.exe" /ShowShortcuts</ShowIcons>
                </RegistrationCommands>
                <IconsVisible>1</IconsVisible>
                <OEMSettings />
              </InstallationInformation>
              <ShellCommands>
                <ApplicationId>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe</ApplicationId>
                <Open>"[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe" -mail</Open>
              </ShellCommands>
              <MAPILibrary>[{ProgramFilesX86}]\Mozilla Thunderbird\mozMapi32_InUse.dll</MAPILibrary>
              <MailToProtocol>
                <Description>Thunderbird URL</Description>
                <EditFlags>2</EditFlags>
                <DefaultIcon>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe,0</DefaultIcon>
                <ShellCommands>
                  <ApplicationId>[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe</ApplicationId>
                  <Open>"[{ProgramFilesX86}]\Mozilla Thunderbird\thunderbird.exe" -osint -compose "%1"</Open>
                </ShellCommands>
              </MailToProtocol>
            </EMail>
          </SoftwareClients>
        </Extension>
      </Extensions>
    </SoftwareClients>
```

**Примечание.**  
В этом примере:

-   `<ClientConfiguration EmailEnabled="true" />` это общий параметр Клиенты программного обеспечения для интеграции клиентов электронной почты

-   `<EMail MakeDefault="true">` является флагом для настройки определенного клиента электронной почты в качестве клиента электронной почты по умолчанию

-   `<MAPILibrary>[{ProgramFilesX86}]\Mozilla Thunderbird\mozMapi32_InUse.dll</MAPILibrary>` является регистрация dll MAPI

 

### <a name="url-protocol-handler"></a>Обработник протокола URL-адреса

Приложения не всегда конкретно называются виртуализированными приложениями, использующими вызов типа файла. Например, в приложении, которое поддерживает встраив почтовое сообщение: ссылка внутри документа или веб-страницы, пользователь щелкает по почте: ссылку и ожидает получения зарегистрированного почтового клиента. App-V поддерживает обработчики протоколов URL-адресов, которые можно зарегистрировать на основе каждого пакета в локальной операционной системе. Во время последовательности обработчики протоколов URL-адресов автоматически добавляются в пакет.

В ситуациях, когда существует несколько приложений, которые могут зарегистрировать определенный обработок протокола URL-адресов, динамические файлы конфигурации можно использовать для изменения поведения и подавления или отключения этой функции для приложения, которое не должно быть основным запущенным приложением.

### <a name="apppath"></a>AppPath

Точка расширения AppPath поддерживает вызов приложений App-V непосредственно из операционной системы. Обычно это выполняется с экрана Run или Start Screen в зависимости от операционной системы, которая позволяет администраторам предоставлять доступ к приложениям App-V из команд операционной системы или сценариев без вызова определенного пути к исполняемой. Поэтому позволяет избежать изменения переменной среды пути системы во всех системах, как это выполняется во время публикации.

Точка расширения AppPath настроена в манифесте или в динамических файлах конфигурации и хранится в реестре на локальном компьютере во время публикации для пользователя. Дополнительные сведения о обзоре AppPath: <https://go.microsoft.com/fwlink/?LinkId=392835> .

### <a name="virtual-application"></a>Виртуальное приложение

В этой подсистеме содержится список приложений, захваченных во время секвенировать, которые обычно потребляются другими компонентами App-V. Интеграция точек расширения, принадлежащих конкретному приложению, может быть отключена с помощью динамических файлов конфигурации. Например, если пакет содержит два приложения, можно отключить все точки расширения, принадлежащие одному приложению, чтобы разрешить только интеграцию точек расширения другого приложения.

### <a name="extension-point-rules"></a>Правила точки расширения

Описанные выше точки расширения интегрированы в операционную систему в зависимости от того, как были опубликованы пакеты. Глобальная публикация помещает точки расширения в расположениях общедоступных машин, где публикация пользователей помещает точки расширения в расположениях пользователей. Например, ярлык, созданный на рабочем столе и опубликованный глобально, приведет к тому, что данные файлов будут создаваться для ярлыка (%Public%\\\Desktop) и данных реестра (HKLM\\Software\\Classes). Этот же ярлык будет иметь данные файлов (%UserProfile%\\Desktop) и данные реестра (HKCU\\Software\\Classes).

Не все точки расширения публикуются одинаково, где некоторые точки расширения требуют глобальной публикации, а другие требуют последовательности в конкретной операционной системе и архитектуре, где они доставляются. Ниже приведена таблица, описываемая этими двумя ключевыми правилами.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Виртуальное расширение</th>
<th align="left">Требуется целевое секвенсинг ОС</th>
<th align="left">Требует глобальной публикации</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>Установленное напрямую доверие</p></td>
<td align="left"><p></p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Ассоциация типов файлов</p></td>
<td align="left"><p></p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Протоколы URL-адресов</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>AppPaths</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>РЕЖИМ COM</p></td>
<td align="left"><p></p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Клиент программного обеспечения</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Возможности приложения</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработник меню контекста</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработник перетаскивания</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработник объектов данных</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработник листа свойств</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Обработщик Infotip</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Обработник столбцов</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="even">
<td align="left"><p>Расширения shell</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p></p></td>
</tr>
<tr class="odd">
<td align="left"><p>Объект помощника браузера</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
<tr class="even">
<td align="left"><p>Объект Active X</p></td>
<td align="left"><p>X</p></td>
<td align="left"><p>X</p></td>
</tr>
</tbody>
</table>

 

## <a name="dynamic-configuration-processing"></a><a href="" id="bkmk-dynamic-config"></a>Динамическая обработка конфигурации


Развертывание пакетов App-V на одной машине или пользователе очень просто. Однако по мере развертывания организациями приложений AppV по бизнес-линиям и географическим и политическим границам возможность одновековой последовательности приложения с одним набором параметров становится невозможной. App-V был разработан для этого сценария, так как он захватывает определенные параметры и конфигурации во время последовательного секвенации в файле Манифест, но также поддерживает изменения с динамическими файлами конфигурации.

Динамическая конфигурация App-V позволяет указать политику пакета на уровне машины или на уровне пользователя. Файлы динамической конфигурации позволяют инженерам по секвенации изменять конфигурацию пакета после секвенации для решения потребностей отдельных групп пользователей или машин. В некоторых случаях может потребоваться внести изменения в приложение, чтобы обеспечить надлежащую функциональность в среде App-V. Например, может потребоваться внести изменения в файлы \_\*config.xml, чтобы разрешить выполнение определенных действий в указанное время во время выполнения приложения, например отключение расширения почты, чтобы предотвратить переописывание этого расширения из другого приложения.

Пакеты App-V содержат файл Manifest внутри файла пакета appv, который является представителем операций по секвенации и является политикой выбора, если файлы динамической конфигурации не назначены определенному пакету. После секвенации файлы динамической конфигурации можно изменить, чтобы разрешить публикацию приложения для разных настольных компьютеров или пользователей с различными точками расширения. Двумя динамическими файлами конфигурации являются файлы динамической конфигурации развертывания (DDC) и Dynamic User Configuration (DUC). В этом разделе основное внимание уделяется сочетанию файлов манифеста и динамической конфигурации.

### <a name="example-for-dynamic-configuration-files"></a>Пример динамических файлов конфигурации

В приведенном ниже примере показано сочетание файлов Manifest, Deployment Configuration и User Configuration files after publishing and during normal operation. Эти примеры являются сокращенными примерами каждого из файлов. Цель состоит в том, чтобы показать только комбинацию файлов и не быть полным описанием определенных категорий, доступных в каждом из файлов. Дополнительные сведения можно получить в руководстве по секвенирозингу App-V 5 по: <https://go.microsoft.com/fwlink/?LinkID=269810>

**Манифест**

```xml
<appv:Extension Category="AppV.Shortcut">
     <appv:Shortcut>
          <appv:File>[{Common Programs}]\7-Zip\7-Zip File Manager.lnk</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot}]\7zFM exe.O.ico</appv:Icon>
     </appv:Shortcut>
</appv:Extension>
```

**Конфигурация развертывания**

```xml
<MachineConfiguration>
     <Subsystems>
          <Registry>
               <Include>
                    <Key Path= "\REGISTRY\Machine\Software\7zip">
                    <Value Type="REG_SZ" Name="Config" Data="1234"/>
                    </Key>
               </Include>
          </Registry>
     </Subsystems>
```

**Конфигурация пользователя**

```xml
<UserConfiguration>
     <Subsystems>
<appv:ExtensionCategory="AppV.Shortcut">
     <appv:Shortcut>
          <appv:File>[{Desktop}]\7-Zip\7-Zip File Manager.lnk</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot}]\7zFM exe.O.ico</appv:Icon>
     </appv:Shortcut>
</appv:Extension>
     </Subsystems>
<UserConfiguration>
     <Subsystems>
<appv:Extension Category="AppV.Shortcut">
     <appv:Shortcut>
          <appv:Fìle>[{Desktop}]\7-Zip\7-Zip File Manager.lnk</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot}]\7zFM.exe.O.ico</appv:Icon>
     </appv:Shortcut>
     <appv:Shortcut>
          <appv:File>[{Common Programs}]\7-Zip\7-Zip File Manager.Ink</appv:File>
          <appv:Target>[{AppVPackageRoot}]\7zFM.exe</appv:Target>
          <appv:Icon>[{AppVPackageRoot)]\7zFM.exe.O.ico</appv: Icon>
     </appv:Shortcut>
</appv:Extension>
     </Subsystems>
<MachineConfiguration>
     <Subsystems>
          <Registry>
               <Include>
                    <Key Path="\REGISTRY\Machine\Software\7zip">
                    <Value Type=”REG_SZ" Name="Config" Data="1234"/>
               </Include>
          </Registry>
     </Subsystems>
```

## <a name="side-by-side-assemblies"></a><a href="" id="bkmk-sidebyside-assemblies"></a>Боковая сборка


App-V поддерживает автоматическую упаковку сборок бок о бок (SxS) во время секвенации и развертывания на клиенте во время публикации виртуального приложения. App-V 5 SP2 поддерживает захват сборки SxS во время последовательного секвенмента для сборки, не присутствуют на машине последовательного секвенмента. А для сборки, состоящей из Visual C++ (Версия 8 и более новая) и/или MSXML времени работы, секвенсор автоматически обнаруживает и захватывает эти зависимости, даже если они не были установлены во время мониторинга. Функция сборки side by Side удаляет ограничения предыдущих версий App-V, где секвенсор App-V не фиксирует сборки, уже присутствующие на рабочей станции последовательности, и приватизирует сборки, которые ограничивались одной битовой версией каждого пакета. Это поведение привело к развертыванию приложений App-V для клиентов, пропускающих необходимые сборки SxS, что привело к сбоям в запуске приложений. Это заставило процесс упаковки документировать, а затем убедиться, что все сборки, необходимые для пакетов, были локально установлены в клиентской операционной системе пользователя, чтобы обеспечить поддержку виртуальных приложений. С учетом количества сборки и отсутствия документации по приложениям для необходимых зависимостей эта задача была одновременно и задачей управления, и реализации.

Бок о бок поддержка сборки в App-V имеет следующие функции.

-   Автоматические захваты сборки SxS во время sequencing независимо от того, была ли сборка уже установлена на рабочей станции последовательности.

-   Клиент App-V автоматически устанавливает необходимые сборки SxS на клиентский компьютер во время публикации, когда они не присутствуют.

-   Секвенсор сообщает о зависимости времени работы VC в механизме отчетов секвенсора.

-   Секвенсор позволяет не упаковывать сборки, которые уже установлены на секвенсоре, поддерживая сценарии, в которых сборки ранее были установлены на целевых компьютерах.

### <a name="automatic-publishing-of-sxs-assemblies"></a>Автоматическая публикация сборки SxS

Во время публикации пакета App-V со сборками SxS клиент App-V проверяет наличие сборки на компьютере. Если сборка не существует, клиент развертывает сборку на компьютере. Пакеты, которые являются частью групп подключения, будут полагаться на установки сборки side by Side, которые являются частью базовых пакетов, так как группа подключения не содержит сведений об установке сборки.

**Примечание.**  
Неопубликовка или удаление пакета со сборкой не удаляет сборки для этого пакета.

 

## <a name="client-logging"></a><a href="" id="bkmk-client-logging"></a>Ведение журнала клиента


Клиент App-V в журнале событий Windows в стандартном формате ETW. Конкретные события App-V можно найти в поле просмотра событий в журнале Приложения и службы\\\Microsoft\\AppV\\Client.

**Примечание.**  
В App-V 5.0 SP3 некоторые журналы были консолидированы и перемещены в следующее расположение:

`Event logs/Applications and Services Logs/Microsoft/AppV/ServiceLog`

Список перемещенных журналов см. в [журнале App-V 5.0 SP3.](about-app-v-50-sp3.md#bkmk-event-logs-moved)

 

Ниже описаны три конкретные категории событий.

**Admin.** Журналы событий для конфигураций, применяемых к клиенту App-V, и содержит основные предупреждения и ошибки.

**Операционная**работа. Журналы общего выполнения App-V и использования отдельных компонентов, создающих журнал аудита операций App-V, которые были завершены в клиенте App-V.

**Виртуальное**приложение: регистрирует запуск виртуального приложения и использование подсистем виртуализации.






 

 





